


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    In-Memory Representation | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server."/>

    <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>

    <script src="../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>


    <section class="custom-promo-banner-wrap">
    <div class="custom-promo-banner--relative">
        <div class="custom-promo-banner--img-left">
            <img src="../_static/img/Scylla-Summit-Banner-globs-left.svg">
        </div>
        <div class="custom-promo-banner--img-center">
            <img src="../_static/img/Scylla-Summit-Banner-globs-middle.svg">
        </div>
        <div class="custom-promo-banner--img-right">
            <img src="../_static/img/Scylla-Summit-Banner-globs-right.svg">
        </div>

        <div class="custom-promo-banner">
            <img class="custom-promo-banner--logo" src="../_static/img/slide-summit21-logo@2x.png" alt="">
            <div class="custom-promo-banner--title summit">Database Monsters of the World Connect! Virtual Conference | January 12-14</div>
            <a class="custom-promo-banner--button summit" href="https://scylladb.com/scylla-summit-2021/">Register Now <i class="fa fa-angle-right" style="margin-left: 10px;" aria-hidden="true"></i></a><button class="custom-promo-banner--close">×</button>
        </div>
    </div>
</section>



<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/scylla">Scylla Developer Notes</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">

        

        <div class="section" id="in-memory-representation">
<h1>In-Memory Representation<a class="headerlink" href="#in-memory-representation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Instances of all C++ objects need to have their size fixed and known at compile
time. This is a significant restriction when it comes to minimising the memory
footprint of objects that are kept alive for a long amount of time.</p>
<p>Introducing a serialisation format that allows objects to be of a variable size
enables a range of possible optimisations, but manually writing serialisation
and deserialisation code for all required types would not only be tedious, but
also quite quickly result in an unmaintainable code.</p>
<p>IMR attempts to solve this problem by providing a general infrastructure for
serialisation and deserialisation with a goal of imposing as little limitations
as possible and generating as efficient code as possible.</p>
</div>
<div class="section" id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="contexts">
<h3>Contexts<a class="headerlink" href="#contexts" title="Permalink to this headline">¶</a></h3>
<p>The IMR expects that in many cases multiple objects will share certain
properties in a very predictable way. This can be taken advantage of by not
storing all the information necessary to correctly read IMR objects inside them,
but moving the shared part to an external state.</p>
<p>Fundamental and compound IMR types are designed with this in mind and many of
them require an external context to provide additional information necessary
during deserialisation.</p>
<p><em>For example, <code class="docutils literal notranslate"><span class="pre">imr::buffer&lt;Tag&gt;</span></code> doesn’t store its size anywhere, but requires
to be provided at deserialisation with a context object that implements
<code class="docutils literal notranslate"><span class="pre">size_of&lt;Tag&gt;()</span></code> member function.</em></p>
<p>The IMR itself doesn’t care about the source of the information the context
provide. It can come either from an external state that describes properties of
multiple instances of a particular IMR type or the context logic may read parts
of an IMR object itself. It is also worth noting that objects are not tied to
contexts in any way. The user code could use different context object (with
different internal logic) as long as the decisions it makes are the same and
sufficient for that particular use.</p>
<p><em>For example, in a structure a <code class="docutils literal notranslate"><span class="pre">imr::buffer&lt;Tag&gt;</span></code> could be preceded by an
integer which determines its size. When a context is created it takes a pointer
to the structure, reads the size field and returns it when asked by the buffer
deserialiser.</em></p>
<div class="section" id="context-factories">
<h4>Context factories<a class="headerlink" href="#context-factories" title="Permalink to this headline">¶</a></h4>
<p>In many cases a context is going to combine some external state and data stored
in an IMR object to provide information necessary to deserialise it. In order
to make creation of context more convenient context factories were introduced
which are objects that keep the external state and create an actual context
instance when given a pointer to an IMR object.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">context_factory</span><span class="o">&lt;</span><span class="n">ContextType</span><span class="p">,</span> <span class="n">ExternalState</span><span class="o">&gt;</span> <span class="n">factory</span><span class="p">(</span><span class="n">external_state</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">context</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">pointer_to_an_imr_object</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="views-mutable-views">
<h3>Views &amp; mutable views<a class="headerlink" href="#views-mutable-views" title="Permalink to this headline">¶</a></h3>
<p>The interface for deserialising an IMR object is built around views. An IMR type
given context and a pointer to an IMR object returns a view object that
provides methods specific for that type. For fundamental types these functions
will usually provide a way of creating an equivalent C++ type. In case of
compound types their views will allow accessing members in a checked or
unchecked manner.</p>
<p>Some IMR types can be updated in place. A mutable view of their instances can
be created which aside from providing an interface for reading the object will
also allow it to be updated.</p>
</div>
<div class="section" id="serialisers">
<h3>Serialisers<a class="headerlink" href="#serialisers" title="Permalink to this headline">¶</a></h3>
<p>IMR objects are serialised in three phases:</p>
<ol class="simple">
<li><p>Computing the object sizes and recording any necessary memory allocations.</p></li>
<li><p>Allocating memory. This is the only phase that can fail.</p></li>
<li><p>Writing serialised data.</p></li>
</ol>
<p>It is imperative that the decisions made in the first (sizing) and the third
(writing) phase are exactly the same. In order to make that easier to guarantee
the serialisation interfaces of many compound types accept a lambda template
which is first invoked with a sizer and later with a writer helper objects.</p>
<div class="section" id="placeholders">
<h4>Placeholders<a class="headerlink" href="#placeholders" title="Permalink to this headline">¶</a></h4>
<p>If all instances of an IMR type are guaranteed to be the same size it is
possible to defer their serialisation. The serialisation function can be given
a placeholder object which would later be set to an actual value.</p>
</div>
<div class="section" id="continuation-hooks">
<h4>Continuation hooks<a class="headerlink" href="#continuation-hooks" title="Permalink to this headline">¶</a></h4>
<p>Compound types can be nested, e.g. a member of a structure can be another
structure. However, as mentioned in the <a class="reference external" href="#serialisers">Serialisers</a> section the
basic interface for serialisation is to accept lambda objects. In case of
nested structures this would require creating a nested lambdas which can be
inconvenient and result in a code that is hard to follow.</p>
<p>The solution is to introduce continuation hooks to serialisation helpers. The
outer structure serialisation helper provides a <code class="docutils literal notranslate"><span class="pre">serialize_nested()</span></code> member
function for serialising the inner one. The function returns a serialisation
helper for the nested structure which behaves as the stand-alone one except
that when <code class="docutils literal notranslate"><span class="pre">done()</span></code> is called it returns back a serialisation helper for the
outer structure.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">serializer</span>
    <span class="p">.</span><span class="n">serialize</span><span class="p">(...)</span>
    <span class="p">.</span><span class="n">serialize_nested</span><span class="p">()</span>
        <span class="p">.</span><span class="n">serialize</span><span class="p">(...)</span>
        <span class="p">.</span><span class="n">done</span><span class="p">()</span>
    <span class="p">.</span><span class="n">serialize</span><span class="p">(...)</span>
    <span class="p">.</span><span class="n">done</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="imr-types">
<h3>IMR types<a class="headerlink" href="#imr-types" title="Permalink to this headline">¶</a></h3>
<div class="section" id="tags">
<h4>Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h4>
<p>IMR extensively uses tags to name members of a compound type or match an
instance of a type with an appropriate member function of the deserialisation
context.</p>
<p>Any type can be a tag, but it is customary to use incomplete classes with a
meaningful names for this purpose.</p>
<p>Reusing tags should be avoided in order to avoid clashes.</p>
</div>
<div class="section" id="type-concept">
<h4>Type concept<a class="headerlink" href="#type-concept" title="Permalink to this headline">¶</a></h4>
<p>Most IMR types follow a similar interface for serialisation and
deserialisation. There may be, however, some differences specific to a
particular type and its purpose.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">imr_type</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">make_view</span><span class="p">(</span><span class="k">const</span> <span class="n">uint_t</span><span class="o">*</span> <span class="n">imr_object</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="nf">make_view</span><span class="p">(</span><span class="n">uint_t</span><span class="o">*</span> <span class="n">imr_object</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="c1">// Returns the size of a serialized IMR object</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="n">serialized_object_size</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">imr_object</span><span class="p">,</span> <span class="k">const</span> <span class="n">Context</span><span class="o">&amp;</span> <span class="n">context</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="c1">// Returns the size of a serialized object without actually serializing it.</span>
    <span class="c1">// Arguments depend on the IMR type.</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">size_when_serialized</span><span class="p">(...)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="c1">// Returns the size of a serialized object. Arguments depend on the actual</span>
    <span class="c1">// IMR type.</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">serialize</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span> <span class="p">...)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fundamental-types">
<h2>Fundamental types<a class="headerlink" href="#fundamental-types" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<thead>
<tr>
<th>Type</th>
<th align="center">Fixed size</th>
<th align="center">Needs context</th>
<th align="center">In-place update</th>
<th align="center">Placeholders</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>flags</code></td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
<tr>
<td><code>pod</code></td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
<tr>
<td><code>buffer</code></td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes (length cannot change)</td>
<td align="center">No</td>
</tr>
</tbody>
</table><div class="section" id="flags">
<h3><code class="docutils literal notranslate"><span class="pre">flags</span></code><a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">set_flag</span> <span class="p">{</span>
    <span class="n">set_flag</span><span class="p">(</span><span class="kt">bool</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tags</span><span class="p">...</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">flags</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">view</span> <span class="p">{</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="o">&gt;</span>
        <span class="kt">bool</span> <span class="n">get</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>

        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="o">&gt;</span>
        <span class="kt">bool</span> <span class="n">set</span><span class="p">(</span><span class="kt">bool</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="c1">// Sets flags which tags are present in Tags1, the remaining flags are</span>
    <span class="c1">// cleared.</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Tags1</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">imr</span><span class="o">::</span><span class="n">set_flag</span><span class="o">&lt;</span><span class="n">Tags1</span><span class="o">&gt;</span><span class="p">...)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is a bitfield of named flags. Each declared flag uses exactly one bit
and the whole bitfield uses the smalles number of bytes possible to fit all
required bits.</p>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is a fixed-size type that can be updated in place and doesn’t require
and external context for deserialisation.</p>
</div>
<div class="section" id="pod">
<h3><code class="docutils literal notranslate"><span class="pre">pod</span></code><a class="headerlink" href="#pod" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">PODType</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">pod</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">view</span> <span class="p">{</span>
        <span class="n">PODType</span> <span class="n">load</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
        <span class="kt">void</span> <span class="nf">store</span><span class="p">(</span><span class="n">PODType</span> <span class="n">object</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">PODType</span> <span class="n">object</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pod</span></code> is a POD object using the same representation as that defined by the C++
ABI including all the internal padding in case of compound types. It is
therefore recommended that <code class="docutils literal notranslate"><span class="pre">pod</span></code> is used exclusively to represent C++
fundamental types.</p>
<p><code class="docutils literal notranslate"><span class="pre">pod</span></code> is a fixed-size type which can be updated in place.
It does not require an external context for deserialisation.</p>
</div>
<div class="section" id="buffer">
<h3><code class="docutils literal notranslate"><span class="pre">buffer</span></code><a class="headerlink" href="#buffer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">buffer</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">view</span> <span class="o">=</span> <span class="n">bytes_view</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">bytes_view</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">buffer</span></code> is a type representing an array of bytes of an arbitrary length.</p>
<p><code class="docutils literal notranslate"><span class="pre">buffer</span></code> is a variable-size type which can be updated in-place as long as the
length of the buffer remains unchanged.</p>
<div class="section" id="context-requirements">
<h4>Context requirements<a class="headerlink" href="#context-requirements" title="Permalink to this headline">¶</a></h4>
<p>Deserialisation of <code class="docutils literal notranslate"><span class="pre">buffer</span></code> objects requires an external context providing the
following member:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span> <span class="n">size_of</span><span class="o">&lt;</span><span class="n">Tag</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">Tag</span></code> is the same type as the one used as a template parameter for
<code class="docutils literal notranslate"><span class="pre">buffer</span></code>. <code class="docutils literal notranslate"><span class="pre">size_of()</span></code> is must return the length of the buffer.</p>
</div>
</div>
</div>
<div class="section" id="compound-types">
<h2>Compound types<a class="headerlink" href="#compound-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tagged-type">
<h3><code class="docutils literal notranslate"><span class="pre">tagged_type</span></code><a class="headerlink" href="#tagged-type" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">IMRType</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="nl">tagged_type</span> <span class="p">:</span> <span class="n">IMRType</span> <span class="p">{</span> <span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tagged_type</span></code> is a thin wrapper around an IMR type that allows annotating it
with a tag without changing its views or serialisers in any way.</p>
<p>The main purpose of adding tags to the type name is to allow defining custom
methods for only some usage of a particular IMR type (see section
<a class="reference external" href="#methods">Methods</a>).</p>
</div>
<div class="section" id="optional">
<h3><code class="docutils literal notranslate"><span class="pre">optional</span></code><a class="headerlink" href="#optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">IMRType</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">optional</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">view</span> <span class="p">{</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
        <span class="n">IMRType</span><span class="o">::</span><span class="n">view</span> <span class="n">get</span><span class="p">(</span><span class="k">const</span> <span class="n">Context</span><span class="o">&amp;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">optional</span></code> represents an object that may not be present in some circumstances.
Information whether it does is not stored in any sort of metadata, but the
deserialisation context is expected to provide it.</p>
<div class="section" id="id1">
<h4>Context requirements<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">is_present</span><span class="o">&lt;</span><span class="n">Tag</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></div>
</div>
<p>Optionals require the deserialisation context to provide information whether
the underlying object is present.</p>
</div>
</div>
<div class="section" id="variant">
<h3><code class="docutils literal notranslate"><span class="pre">variant</span></code><a class="headerlink" href="#variant" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">IMRType</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">alternative</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Alternatives</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">variant</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">view</span> <span class="p">{</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">AlternativeTag</span><span class="o">&gt;</span>
        <span class="k">auto</span> <span class="n">as</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>

        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Visitor</span><span class="o">&gt;</span>
        <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">accept</span><span class="p">(</span><span class="n">Visitor</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">AlternativeTag</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...)</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">variant</span></code> is a compound type that has multiple alternatives, each being an
IMR type. At any time there is exactly one active alternative and it is the
only one that can be read. Variants do not store information about the active
alternative by themselves but rely on the external context to provide that
information.</p>
<div class="section" id="id2">
<h4>Context requirements<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">imr</span><span class="o">::</span><span class="n">variant</span><span class="o">::</span><span class="n">alternative_index</span> <span class="n">active_alternative_of</span><span class="o">&lt;</span><span class="n">Tag</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">AlternativeTag</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">context_for</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></div>
</div>
<p>Variant requires deserialisation context to provide information which one of
its alternatives is active as well as context for deserialisation of that
alternative.</p>
</div>
</div>
<div class="section" id="structure">
<h3><code class="docutils literal notranslate"><span class="pre">structure</span></code><a class="headerlink" href="#structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">IMRType</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">member</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Members</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">structure</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">view</span> <span class="p">{</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">MemberTag</span><span class="o">&gt;</span>
        <span class="k">auto</span> <span class="n">get</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span>

        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">MemberTag</span><span class="o">&gt;</span>
        <span class="kt">size_t</span> <span class="n">offset_of</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Writer</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Writer</span><span class="o">&amp;&amp;</span><span class="p">,</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="n">get_member</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">Context</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">structure_writer</span> <span class="p">{</span>
    <span class="c1">// For imr::optional:</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...);</span>

    <span class="k">auto</span> <span class="nf">skip</span><span class="p">();</span>

    <span class="c1">// For imr::variant:</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">AlternativeTag</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="n">serialize_as</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...);</span>

    <span class="c1">// For other types:</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
    <span class="k">auto</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...);</span>

    <span class="c1">// After all members:</span>
    <span class="k">auto</span> <span class="nf">done</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">structure</span></code> is a compound type that stores possibly multiple member objects
one after another. All members are always present and their IMR type is fixed.</p>
<p>The interface for serialising structures is based on serialisation helpers.
Methods <code class="docutils literal notranslate"><span class="pre">serialize()</span></code> and <code class="docutils literal notranslate"><span class="pre">size_when_serialized()</span></code> accept a lambda that would
be given a serialisation helper object. That object expects its member function
<code class="docutils literal notranslate"><span class="pre">serialize()</span></code> (there are slightly different ones for optional and variant
structure members) to be invoked with an arguments that would normally be passed
to methods <code class="docutils literal notranslate"><span class="pre">structure()</span></code> and <code class="docutils literal notranslate"><span class="pre">size_when_serialized()</span></code> of the type of the member
that is being serialised (in the order they appear in the structure definition).
After the last member has been serialised <code class="docutils literal notranslate"><span class="pre">done()</span></code> is to be called and its
return value returned from the lambda.</p>
<div class="section" id="id3">
<h4>Context requirements<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">AlternativeTag</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">context_for</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<p>IMR types can define destructor and mover methods. Their goal is to provide
similar functionality to C++ destructors and move constructors and thus enable
owning references inside IMR objects. Movers are also essential in ensuring
that all references are properly updated when LSA moves objects around.</p>
<p>The default mover and destructor for fundamental types does nothing. The
default methods for compound types and containers invokes that method for
all present elements in an unspecified order.</p>
<p>User can define mover and destructor methods for any IMR type which would
override any default methods that this type might have.</p>
<p>Neither movers nor destructors are allowed to fail.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">mover</span><span class="o">&lt;</span><span class="n">IMRType</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">void</span> <span class="n">run</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">Context</span><span class="o">&amp;</span> <span class="n">ctx</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
        <span class="c1">// user-defined mover action</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="k">struct</span> <span class="n">imr</span><span class="o">::</span><span class="n">destructor</span><span class="o">&lt;</span><span class="n">IMRType</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">void</span> <span class="n">run</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="k">const</span> <span class="n">Context</span><span class="o">&amp;</span> <span class="n">ctx</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
        <span class="c1">// user-defined destructor action</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="section" id="mover">
<h3>Mover<a class="headerlink" href="#mover" title="Permalink to this headline">¶</a></h3>
<p>When an IMR object is being moved its serialised form is copied to the new
place in memory and then a mover method is called with the address of the new
location passed as an argument.</p>
<p><em>Note that, unlike C++, IMR does not call the destructor of the object moved
from. In other words, while moving in C++ involves creating a new object that
steals internal state from another, IMR just copies the object to the new
location and invokes a mover to give it a chance to do necessary updates, it is
however still considered to be the same object as the original one.</em></p>
</div>
<div class="section" id="destructor">
<h3>Destructor<a class="headerlink" href="#destructor" title="Permalink to this headline">¶</a></h3>
<p>The destructor of an IMR object is called before the storage it occupies is
freed. The address of the object passed to the destructor is either a location
at which the object was originally created or the address that was given to the
latest invocation of the object mover method.</p>
</div>
</div>
<div class="section" id="memory-allocations">
<h2>Memory allocations<a class="headerlink" href="#memory-allocations" title="Permalink to this headline">¶</a></h2>
<p>IMR objects are allowed to own memory and it is therefore expected that during
serialisation there will be a need to perform allocation. A convenience class
<code class="docutils literal notranslate"><span class="pre">imr::alloc::object_allocator</span></code> exists to aid this process.</p>
<p>The object allocator provides serialisation helpers for both sizing and writing
phases, which act similarily to the structure serialisation helpers and return
a pointer to the owned object. After the sizing phase member function
<code class="docutils literal notranslate"><span class="pre">allocate_all()</span></code> needs to be called which allocates all the reserved buffers.</p>
<p><em>Note that in case there is a chain of owned objects (e.g. a list) placeholders
can be used for pointers to avoid recursion.</em></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">imr_type1</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">using</span> <span class="n">imr_type2</span> <span class="o">=</span> <span class="p">...;</span>

<span class="n">imr</span><span class="o">::</span><span class="n">alloc</span><span class="o">::</span><span class="n">object_allocator</span> <span class="n">allocator</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">writer</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">(</span><span class="k">auto</span> <span class="n">serializer</span><span class="p">,</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">allocator</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
    <span class="n">imr</span><span class="o">::</span><span class="n">placeholder</span><span class="o">&lt;</span><span class="n">imr</span><span class="o">::</span><span class="n">pod</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">*&gt;&gt;</span> <span class="n">pointer</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">serializer</span>
        <span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span>
        <span class="p">.</span><span class="n">done</span><span class="p">();</span>

    <span class="k">auto</span> <span class="n">pointer_to_owned_object</span> <span class="o">=</span> <span class="n">allocator</span><span class="p">.</span><span class="n">allocate_nested</span><span class="o">&lt;</span><span class="n">imr_type2</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="p">.</span><span class="n">serialize</span><span class="p">(...)</span>
        <span class="p">.</span><span class="n">serialize</span><span class="p">(...)</span>
        <span class="p">.</span><span class="n">done</span><span class="p">();</span>

    <span class="n">pointer</span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">pointer_to_owned_object</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">imr_type1</span><span class="o">::</span><span class="n">size_when_serialized</span><span class="p">(</span><span class="n">writer</span> <span class="p">,</span> <span class="n">allocator</span><span class="p">.</span><span class="n">get_size</span><span class="p">());</span>

<span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">total_storage</span><span class="p">());</span>
<span class="n">allocator</span><span class="p">.</span><span class="n">allocate_all</span><span class="p">();</span>

<span class="n">imr_type1</span><span class="o">::</span><span class="n">serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">writer</span><span class="p">,</span> <span class="n">allocator</span><span class="p">.</span><span class="n">get_serializer</span><span class="p">());</span>
</pre></div>
</div>
<div class="section" id="log-structured-allocator-support">
<h3>Log-Structured Allocator support<a class="headerlink" href="#log-structured-allocator-support" title="Permalink to this headline">¶</a></h3>
<p>LSA relies on migrator objects to provide logic necessary for moving objects
and obtaining their size. To do these action the information about the IMR type
of the object needs to be preserved as well as at least minimal external
context sufficient for calling the mover.</p>
<p>A helper class template is provided which takes the IMR type and (context
factory)[#context_factories] type as template parameters as well as actual
context factory in constructor and implements <code class="docutils literal notranslate"><span class="pre">migrate_fn_type</span></code> interface.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">imr</span><span class="o">::</span><span class="n">alloc</span><span class="o">::</span><span class="n">lsa_migrate_fn</span><span class="o">&lt;</span><span class="n">IMRType</span><span class="p">,</span> <span class="n">ContextFactory</span><span class="o">&gt;</span> <span class="n">migrator</span><span class="p">(</span><span class="n">context_factory</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">current_allocator</span><span class="p">().</span><span class="n">alloc</span><span class="p">(</span><span class="n">migrator</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="compaction_controller.html">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">In-Memory Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol-extensions.html">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/scylla/issues/new?title=Issue in page In-Memory Representation&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylladb.github.io/scylla/master/design-notes/in_memory_representation%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2021, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 04 January 2021.
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../_static/js/vendor/jquery.js"></script>
<script src="../_static/js/vendor/jquery.cookie.min.js"></script>
<script src="../_static/expertrec.js"></script>
<script src="../_static/js/foundation/foundation.js"></script>
<script src="../_static/js/foundation/foundation.topbar.js"></script>
<script src="../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>